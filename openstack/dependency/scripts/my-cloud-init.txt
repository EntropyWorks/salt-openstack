#cloud-config
# Copyright 2012-2013 Hewlett-Packard Development Company, L.P.
# All Rights Reserved.
#
# Authored by Yazz D. Atlas <yazz.atlas@hp.com>
#
#    Licensed under the Apache License, Version 2.0 (the "License"); you may
#    not use this file except in compliance with the License. You may obtain
#    a copy of the License at
#
#         http://www.apache.org/licenses/LICENSE-2.0
#
#    Unless required by applicable law or agreed to in writing, software
#    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
#    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
#    License for the specific language governing permissions and limitations
#    under the License.
#
#  You will need to change the IP of your salt master bellow in two places.
bootcmd:
 - echo 10.9.64.6 salt >> /etc/hosts

apt_sources:
  - source: "ppa:saltstack/salt"

# Setting the salt-master this way because this was for a test envirionment
salt_minion:
  conf:
    master: 10.9.64.6

# Unless you want me to ssh into your machines I would replace this. (I will not ssh into your
# nodes even if you leave this in.) Change "entropyworks" to your http://launchpad.net/ account 
# name. 
ssh_import_id: [entropyworks]

# Install some handy packages
packages:
 - tiobench
 - sysstat
 - fstat
 - dstat
 - salt-minion

# Stress test the machine and check the IO perfomance.
runcmd:
 - [ tiobench, "--size", 8000, "--numruns", 10, "--block", 4096, "--block", 8192 ]

final_message: "The system is finally up, after $UPTIME seconds"

# Log the output.
output:
 init: "> /var/log/my-cloud-init.log"
 config: [ ">> /tmp/foo.out", "> /tmp/foo.err" ]
 final:
   output: "| tee /tmp/final.stdout | tee /tmp/bar.stdout"
   error: "&1"
def_log_file: /var/log/my-logging-file.log
syslog_fix_perms: syslog:root
